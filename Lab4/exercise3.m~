goaldist = 1;
robot =  raspbot('Raspbot-9');
encoderStart = (robot.encoders.LatestMessage.Vector.X + robot.encoders.LatestMessage.Vector.Y) / 2;
encoderCurr = (robot.encoders.LatestMessage.Vector.X + robot.encoders.LatestMessage.Vector.Y) / 2;
e = (goaldist)-(encoderCurr-encoderStart);
%nooooo get from encoder
kp = 5; kd = 0.01; ki = 0;
%upid = kp * e + kd * derivative(e) + kp * integral of e dt
tstart = tic;
tcurr = toc(tstart);
eint = 0;
eintmax = .1;
uref = 0;
distErr = [];
graphyThing = [];
time = [];
oldoldt = 0; 
sgn = 1;
uref = .1;
distActual = 0;
sref = 0;
tdelay = 0.2;
sdelay = 0;
while ((tcurr < 6) && (abs(e) > 0.0001))
    olde = e;
    oldt = tcurr;
    encoderCurr = (robot.encoders.LatestMessage.Vector.X + robot.encoders.LatestMessage.Vector.Y) / 2;
    e = (goaldist)-(encoderCurr-encoderStart);
    distActual = encoderCurr-encoderStart;
    tcurr = toc(tstart);
    dedt = (e-olde)/(tcurr-oldt);
    eint = eint + (e * (tcurr-oldt));
    if (abs(eint) > eintmax)
        if (eint > 0)
            eint = eintmax;
        else
            eint = -1 * eintmax;
        end
    end
    uref = trapezoidalVelocityProfile(tcurr, 3 * 0.25, 0.25, goaldist, sgn);
    sref = sref + uref * (tcurr-oldt);
    udelay = uref(tcurr-tdelay);
    sdelay = sdelay + udelay*(tcurr-oldt);
    
    robot.sendVelocity(uref,uref);
    pause(0.1);
    distErr = [distErr, sref];
    graphyThing = [graphyThing, distActual];
    time = [time, oldoldt + tcurr];
    plot(time, distErr);
    hold on;
    plot(time, graphyThing);
end    
uref = 0;
robot.sendVelocity(uref,uref);
